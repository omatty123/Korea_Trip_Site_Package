<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2025 한국 여행 – 일정 & 지도</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root { --card:#fff; --gray:#666; }
    body { font-family:'Inter',sans-serif; background:#f9fafb; margin:0; color:#111; padding-bottom:4rem; }
    header { position:sticky; top:0; background:#fff; border-bottom:1px solid #ddd; padding:.7rem 1rem;
             display:flex; justify-content:space-between; align-items:center; z-index:20; }
    #toggleBtn { padding:.35rem .9rem; border:1px solid #888; background:#f6f6f6; border-radius:.45rem;
                 cursor:pointer; font-weight:600; }
    #toggleBtn:hover { background:#e9e9e9; }
    main { max-width:48rem; margin:auto; padding:1.2rem; }
    section.card { background:var(--card); border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,.05);
                   margin:1.25rem 0; padding:1rem 1.25rem; }
    h2 { margin:.1rem 0 .5rem; font-size:1.2rem; }
    .addr p { margin:.2rem 0; }
    .map a { display:inline-block; padding:.3rem .75rem; margin:.4rem .5rem .2rem 0; font-size:.8rem;
             text-decoration:none; border-radius:4px; }
    .naver { background:#03c75a; color:#fff; }
    .kakao { background:#ffe812; color:#111; }
    ul { padding-left:1.1rem; margin:0; }
    li { margin:.3rem 0; line-height:1.45; }
    time { font-weight:600; color:var(--gray); }
    .editing [contenteditable="true"] { outline:2px dashed #4a90e2; background:#fdfdff; border-radius:4px; }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:1.15rem;">🇰🇷 2025 한국 여행 일정</h1>
    <button id="toggleBtn" aria-pressed="false">Edit</button>
  </header>

  <main id="itinerary">Loading…</main>

  <script>
    const main = document.getElementById('itinerary');
    const btn  = document.getElementById('toggleBtn');
    const editable = 'li';
    let editing = false;

    /* ---------- build page from JSON ---------- */
    fetch('trip.json').then(r=>r.json()).then(render).then(restore);

    function mapBtns(q){
      const enc = encodeURIComponent(q);
      return `<div class="map">
                <a class="naver" href="https://map.naver.com/v5/search/${enc}" target="_blank">Naver 지도</a>
                <a class="kakao" href="https://map.kakao.com/link/search/${enc}" target="_blank">Kakao 지도</a>
              </div>`;
    }

    function render(days){
      main.textContent='';
      days.forEach(day=>{
        const sec = document.createElement('section');
        sec.className='card';

        const addr = day.addressKo
          ? `<div class="addr">
               <p>${day.addressKo}</p>
               ${day.addressEn?`<p>${day.addressEn}</p>`:''}
               ${mapBtns(day.addressKo)}
             </div>` : '';

        const items = day.items.map((it,i)=>
          `<li data-key="${day.date}-${i}" class="editable"><time>${it.time}</time> ${it.text}</li>`).join('');

        sec.innerHTML = `<h2>${day.date} • ${day.city}</h2>${addr}<ul>${items}</ul>`;
        main.append(sec);
      });
    }

    /* ---------- edit / view toggle ---------- */
    btn.onclick = ()=> setMode(!editing);

    function setMode(on){
      editing = on;
      document.body.classList.toggle('editing',editing);
      btn.textContent = editing ? 'View' : 'Edit';
      btn.setAttribute('aria-pressed',editing);
      document.querySelectorAll(editable).forEach(el=>{
        el.contentEditable = editing;
        if(!editing){
          localStorage.setItem(el.dataset.key, el.innerHTML.trim());
        }
      });
    }

    /* ---------- restore local edits ---------- */
    function restore(){
      document.querySelectorAll(editable).forEach(el=>{
        const saved = localStorage.getItem(el.dataset.key);
        if(saved) el.innerHTML=saved;
      });
    }
  </script>
</body>
</html>
